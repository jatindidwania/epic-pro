<!DOCTYPE html>
<html lang="en">
<head>
      <meta charset="utf-8">
      <meta content="width=device-width, initial-scale=1" name="viewport">
      <title>Heart Disease Analysis &amp; Prediction</title>
      <link href="css/predictor.css" rel="stylesheet">
      <link href="css/style.css" rel="stylesheet">
</head>
<body>
      <script src="//d3js.org/d3.v3.min.js"></script>

<section class="probootstrap-section" data-section="predict" id="predict">
    <div class="container">
        <div class="row text-center mb100">
            <div class="col-md-8 col-md-offset-2 probootstrap-section-heading">
                <h2 class="mb30 text-black probootstrap-heading">Predict your Chance of Having a Heart Disease</h2>
                <p>Enter the appropriate values of symptoms you face. Get the chances of you contracting heart disease
                    based on those values.</p>
            </div>
        </div>
        <!-- END row -->
        <!-- Main Div -->
        <div id="parent">
            <div id="wrapper">
                <div style="text-align: center;">
                    <h1 class="text-black probootstrap-heading">Heart Disease Predictor</h1>
                </div>
                <div class="child1">
                    <table class="naked_table">
                        <tr>
                            <td>
                                <label class="before_slider" for="nSex1">
                                    Sex (0=female,1=male)</label></td>
                            <td class="input_slider">
                                <form class="slider_input">
                                    <input class="hd-slider-width" id="nSex1" max="1" min="0" name="amountRange"
                                           oninput="this.form.amountInput.value=this.value"
                                           step="1" type="range" value="0"/>
                                    <input class="hd-number-width" id="nSex2" max="1" min="0" name="amountInput"
                                           oninput="this.form.amountRange.value=this.value"
                                           step="1" type="number" value="0"/>
                                </form>
                            </td>
                        </tr>
                        <tr>
                            <td><label class="before_slider" for="nRestbp1">
                                Resting Blood Pressure (94 - 200 mmHg)</label></td>
                            <td class="input_slider">
                                <form class="slider_input">
                                    <input class="hd-slider-width" id="nRestbp1" max="200" min="94" name="amountRange"
                                           oninput="this.form.amountInput.value=this.value"
                                           step="all" type="range" value="94"/>
                                    <input class="hd-number-width" id="nRestbp2" max="200" min="94" name="amountInput"
                                           oninput="this.form.amountRange.value=this.value"
                                           step="all" type="number" value="94"/>
                                </form>
                            </td>
                        </tr>
                        <tr>
                            <td><label class="before_slider" for="nThalach1">
                                Thalium Stress Test Maximum Heart Rate (71 - 202)</label></td>
                            <td class="input_slider">
                                <form class="slider_input">
                                    <input class="hd-slider-width" id="nThalach1" max="202" min="71" name="amountRange"
                                           oninput="this.form.amountInput.value=this.value"
                                           step="all" type="range" value="71"/>
                                    <input class="hd-number-width" id="nThalach2" max="202" min="71" name="amountInput"
                                           oninput="this.form.amountRange.value=this.value"
                                           step="all" type="number" value="71"/>
                                </form>
                            </td>
                        </tr>
                        <tr>
                            <td><label class="before_slider" for="nCa1">
                                Number of Major Vessels Colored by Fluoroscopy (0 - 3)</label></td>
                            <td class="input_slider">
                                <form class="slider_input">
                                    <input class="hd-slider-width" id="nCa1" max="3" min="0" name="amountRange"
                                           oninput="this.form.amountInput.value=this.value"
                                           step="all" type="range" value="0"/>
                                    <input class="hd-number-width" id="nCa2" max="3" min="0" name="amountInput"
                                           oninput="this.form.amountRange.value=this.value"
                                           step="all" type="number" value="0"/>
                                </form>
                            </td>
                        </tr>
                        <tr>
                            <td><label class="before_slider" for="nCp1">
                                Chest Pain Type (1=typical angina, 2=atypical angina, 3=non-angina, 4=asymptomatic
                                angina)</label></td>
                            <td class="input_slider">
                                <form class="slider_input">
                                    <input class="hd-slider-width" id="nCp1" max="4" min="1" name="amountRange"
                                           oninput="this.form.amountInput.value=this.value"
                                           step="1" type="range" value="1"/>
                                    <input class="hd-number-width" id="nCp2" max="4" min="1" name="amountInput"
                                           oninput="this.form.amountRange.value=this.value"
                                           step="1" type="number" value="1"/>
                                </form>
                            </td>
                        </tr>
                        <tr>
                            <td><label class="before_slider" for="nSlope1">
                                Peak Exercise ST Segment (0=flat or downsloping, 1=upsloping)</label></td>
                            <td class="input_slider">
                                <form class="slider_input">
                                    <input class="hd-slider-width" id="nSlope1" max="1" min="0" name="amountRange"
                                           oninput="this.form.amountInput.value=this.value"
                                           step="1" type="range" value="0"/>
                                    <input class="hd-number-width" id="nSlope2" max="1" min="0" name="amountInput"
                                           oninput="this.form.amountRange.value=this.value"
                                           step="1" type="number" value="0"/>
                                </form>
                            </td>
                        </tr>
                        <tr>
                            <td><label class="before_slider" for="nThal1">
                                Thalium Test: (0=normal or fixed defect, 1=reversible defect)</label></td>
                            <td class="input_slider">
                                <form class="slider_input">
                                    <input class="hd-slider-width" id="nThal1" max="1" min="0" name="amountRange"
                                           oninput="this.form.amountInput.value=this.value"
                                           step="1" type="range" value="0"/>
                                    <input class="hd-number-width" id="nThal2" max="1" min="0" name="amountInput"
                                           oninput="this.form.amountRange.value=this.value"
                                           step="1" type="number" value="0"/>
                                </form>
                            </td>
                        </tr>
                        <tr>
                            <td></td>
                            <td class="input_slider">
                                <input class="btn btn-primary" onclick="updateOne(val01,-1)" type="button"
                                       value="Reset All Sliders"/>
                            </td>
                        </tr>
                    </table>
                </div>
                <div class="child2">
                    <script>
                        const width = 100;
                        const height = 400;

                        const holder = d3.select(".child2")
                            .append("svg")
                            .attr("width", width)
                            .attr("height", height);

                        // draw a rectangle
                        const y0 = 20;
                        const height0 = 380;
                        holder.append("rect")
                            .attr("x", 5)
                            .attr("y", y0 + height0)
                            .style("fill", "rgb(0,255,0)")
                            .attr("height", 0)
                            .attr("width", 90);

                        // draw a container rectangle
                        holder.append("rect")
                            .attr("x", 5)
                            .attr("y", y0)
                            .style("fill", "none")
                            .style("stroke", "lightblue")
                            .style("stroke-width", 4)
                            .attr("height", height0)
                            .attr("width", 90);

                        // add text inside rectangle
                        holder.append("text")
                            .text("0.00%")
                            .attr("x", 12)
                            .attr("y", y0 + height0 - 10)
                            .attr("fill", "black")
                            .attr("font-family", "Verdana")
                            .attr("font-size", "20");

                        // initialize
                        let val01 = document.getElementById("nSex1").value;
                        let val02 = document.getElementById("nRestbp1").value;
                        let val03 = document.getElementById("nThalach1").value;
                        let val04 = document.getElementById("nCa1").value;
                        let val05 = document.getElementById("nCp1").value;
                        let val06 = document.getElementById("nSlope1").value;
                        let val07 = document.getElementById("nThal1").value;
                        updateOne(val01, 0);

                        // Check for changes in the inputs and update output bar
                        d3.select("#nSex1").on("input", function () {
                            updateOne(+this.value, 1);
                        });
                        d3.select("#nSex2").on("input", function () {
                            updateOne(+this.value, 1);
                        });
                        d3.select("#nRestbp1").on("input", function () {
                            updateOne(+this.value, 2);
                        });
                        d3.select("#nRestbp2").on("input", function () {
                            updateOne(+this.value, 2);
                        });
                        d3.select("#nThalach1").on("input", function () {
                            updateOne(+this.value, 3);
                        });
                        d3.select("#nThalach2").on("input", function () {
                            updateOne(+this.value, 3);
                        });
                        d3.select("#nCa1").on("input", function () {
                            updateOne(+this.value, 4);
                        });
                        d3.select("#nCa2").on("input", function () {
                            updateOne(+this.value, 4);
                        });
                        d3.select("#nCp1").on("input", function () {
                            updateOne(+this.value, 5);
                        });
                        d3.select("#nCp2").on("input", function () {
                            updateOne(+this.value, 5);
                        });
                        d3.select("#nSlope1").on("input", function () {
                            updateOne(+this.value, 6);
                        });
                        d3.select("#nSlope2").on("input", function () {
                            updateOne(+this.value, 6);
                        });
                        d3.select("#nThal1").on("input", function () {
                            updateOne(+this.value, 7);
                        });
                        d3.select("#nThal2").on("input", function () {
                            updateOne(+this.value, 7);
                        });

                        // Update the heart disease probability
                        function updateOne(value, index) {

                            if (index === 1) {
                                val01 = value;
                            } else if (index === 2) {
                                val02 = value;
                            } else if (index === 3) {
                                val03 = value;
                            } else if (index === 4) {
                                val04 = value;
                            } else if (index === 5) {
                                val05 = value;
                            } else if (index === 6) {
                                val06 = value;
                            } else if (index === 7) {
                                val07 = value;
                            } else if (index === -1) {
                                // Set everything back to default state:
                                val01 = document.getElementById("nSex1").defaultValue;
                                document.getElementById("nSex1").value = val01;
                                document.getElementById("nSex2").value = val01;
                                val02 = document.getElementById("nRestbp1").defaultValue;
                                document.getElementById("nRestbp1").value = val02;
                                document.getElementById("nRestbp2").value = val02;
                                val03 = document.getElementById("nThalach1").defaultValue;
                                document.getElementById("nThalach1").value = val03;
                                document.getElementById("nThalach2").value = val03;
                                val04 = document.getElementById("nCa1").defaultValue;
                                document.getElementById("nCa1").value = val04;
                                document.getElementById("nCa2").value = val04;
                                val05 = document.getElementById("nCp1").defaultValue;
                                document.getElementById("nCp1").value = val05;
                                document.getElementById("nCp2").value = val05;
                                val06 = document.getElementById("nSlope1").defaultValue;
                                document.getElementById("nSlope1").value = val06;
                                document.getElementById("nSlope2").value = val06;
                                val07 = document.getElementById("nThal1").defaultValue;
                                document.getElementById("nThal1").value = val07;
                                document.getElementById("nThal2").value = val07;
                            }

                            // Standardize the continuous features:
                            let srbp_val = (val02 - 131.7157) / 17.7478;
                            let sthalach_val = (val03 - 149.3278) / 23.1211;
                            let sca_val = (val04 - 0.6722) / 3.0;

                            // Disentangle the categorical features:
                            let cp_contr = 0.0;
                            if (val05 === 1) {
                                cp_contr = -2.2318;
                            } else if (val05 === 2) {
                                cp_contr = -1.2681;
                            } else if (val05 === 3) {
                                cp_contr = -2.1124;
                            }
                            let slope_contr = 0.0;
                            if (val06 === 1) {
                                slope_contr = -1.4726;
                            }
                            let thal_contr = 0.0;
                            if (val07 === 1) {
                                thal_contr = 1.5009;
                            }

                            // Compute log-odds, then probability:
                            let scprod = 1.4361 * val01 + 0.4415 * srbp_val - 0.4431 * sthalach_val + 3.7984 * sca_val + cp_contr + slope_contr + thal_contr;
                            let drec = 1.0 / (1.0 + Math.exp(-scprod));
                            let drecs = height0 * drec;
                            drec *= 100;

                            // Update plot:
                            let rcolor = percentToRGB(drec);
                            holder.select("rect")
                                .attr("y", y0 + height0 - drecs)
                                .attr("height", drecs)
                                .style("fill", rcolor);

                            holder.select("text")
                                .text(function () {
                                    return parseFloat(Math.round(drec * 100) / 100).toFixed(2) + "%";
                                });

                        }

                        function percentToRGB(percent) {
                            if (percent === 100) {
                                percent = 99
                            }
                            let r, g, b;

                            if (percent < 50) {
                                // green to yellow
                                r = Math.floor(255 * (percent / 50));
                                g = 255;

                            } else {
                                // yellow to red
                                r = 255;
                                g = Math.floor(255 * ((50 - percent % 50) / 50));
                            }
                            b = 0;

                            return "rgb(" + r + "," + g + "," + b + ")";
                        }
                    </script>
                </div>
            </div>
            <div class="clear"></div>
        </div>
    </div>
</section>
<script src="js/scripts.min.js"></script>
<script src="js/custom.js"></script>
</body>
</html>
